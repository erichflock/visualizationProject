<!DOCTYPE html>
<meta charset="utf-8">
<html>

<head>
    <title>Treemap - Emotions</title>
</head>

<!-- load D3js -->
<script src="//d3plus.org/js/d3.js"></script>

<!-- load D3plus after D3js -->
<script src="//d3plus.org/js/d3plus.js"></script>

<!-- create container element for visualization -->
<div id="viz"></div>

<script>

        // get the name of the country clicked on map.html
        var country = sessionStorage.getItem("country");

        // read, filter and select only the Emotion and Count columns from the data
        d3.csv("data/resultdata_0102_sm.csv", function(data) {

            var dataFiltered = data.filter(function (d) {
                if (d["Country"] == country) {
                    return d;
                }
            });
            console.log(data);
            console.log(dataFiltered);

            var emotions = dataFiltered.map(function (d) {
                return {
                    //Country: d.Country,
                    emotion: d.Emotion,
                    count: Number(d.Count), // to the treemap plot work properly, this value must be a number and not a String
                    color: getRandomColor().toString() // color variable added in order to have customized colors for each emotion
                }
            });

            console.log(emotions);

            /*
            http://d3plus.org/examples/basic/9029130/s
             */

            // instantiate d3plus
            var visualization = d3plus.viz()
                .container("#viz") // container DIV to hold the visualization
                .data(emotions) // data to use with the visualization
                .type("tree_map") // visualization type
                .id("emotion") // key for which our data is unique on
                .size("count") // sizing of blocks - Must be of type number(int) and not a String
                .color("color") //customize the color
                .title(country) // Set a title to the window based on the country selected on the previous screen
                .mouse({
                    "move": false,
                    "click": function(d){alert( d.emotion.toUpperCase() + " emotion clicked!")} // we need to change here to go to another html file
                })
                    .draw()             // finally, draw the visualization
        })

        // We need to rewrite this function.
        // The idea is to return one color for each emotion, based on how positive or negative the emotion is
        function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

</script>
</body>
</html>