<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style>
        .card {
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            transition: 0.3s;
            width: 50%;
        }
        /*.card_container {*/
            /*box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);*/
            /*transition: 0.3s;*/
            /*width: 100%;*/
        /*}*/
        .card_container{
            -webkit-transform-style: preserve-3d;
            transform-style: preserve-3d;
            -webkit-perspective: 1000px;
            perspective: 1000px;
        }

        .card_container:hover {
            box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
        }

        .container {
            padding: 2px 16px;
            display: grid;

        }
        .title {
            font-weight: bold;
        }




        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            width: 100%;
            height: 100%;
            position: relative;
            padding-left: 5px;
    </style>
</head>
<body>

<h2>Link News + Country + Emotion</h2>

<div id="card" class="card"></br>
</div>

<script type="text/javascript">

    function cardNewsUrl(data) {

        // dataset preparation
        function agg_day(leaves) {
            var title = leaves.map(function (d) {
                return d['Title'];

            });
            var url = leaves.map(function (d) {
                return d['DocumentIdentifier'];

            });
            return {
                'Title': title,
                'DocumentIdentifier': url
            };
        }

        var nested = d3.nest()
            .key(d => d['Date'])
            .key(d => d['Country'])
            .key(d => d['Emotion'])
            .rollup(agg_day)
            .entries(data);

        let updateCards = (_date, _country, _emotion) => {
            let filteredByDate = nested.filter(day => day.key === _date);
            let filteredByCountry = filteredByDate[0].values.filter(country => country.key === _country);
            let filteredByEmotion = filteredByCountry[0].values.filter(emotion => emotion.key === _emotion);


            var i = 0;
            var len = filteredByEmotion[0].values.DocumentIdentifier.length;
            var links = filteredByEmotion[0].values.DocumentIdentifier;
            var title = filteredByEmotion[0].values.Title;
            for (; i < len; i++) {

                var card_container = document.createElement('div');
                card_container.setAttribute("class", 'card_container')
                var container = document.createElement("div");
                var link_txt = document.createElement('div');
                link_txt.appendChild(document.createTextNode("Link:"));
                link_txt.appendChild(document.createElement("br"));
                link_txt.setAttribute("class", 'title' );
                container.appendChild(link_txt);

                var result = links[i]
                var url = document.createElement('a');
                var t_url = document.createTextNode(links[i]);
                url.setAttribute("href", result);
                url.appendChild(t_url);
                container.appendChild(document.body.appendChild(url));
                container.appendChild(document.createElement("br"));

                var title_txt = document.createElement('div');
                title_txt.appendChild(document.createTextNode("Title:"));
                title_txt.appendChild(document.createElement("br"));
                title_txt.setAttribute("class", 'title' );
                container.appendChild(title_txt);

                container.appendChild(document.createTextNode(title[i]));
                container.appendChild(document.createElement("br"));
                container.setAttribute("class", 'container' );
                card_container.appendChild(container);

                var element = document.getElementById("card");
                element.appendChild(document.createElement("br"));
                element.appendChild(card_container);

            }

        };


        // https://stackoverflow.com/questions/14853779/adding-input-elements-dynamically-to-form

        updateCards('2018-08-01', 'USA', 'ambiguous-expectation');

        // console.log(nested);
    }

    d3.csv("FINAL_Example_resultdata_0102_sm_title.csv", d => {
        d['DocumentIdentifier'] = d['DocumentIdentifier'];
        d['Title'] = d['Title'];
        d['Date'] = d['Date'];
        d['Country'] = d['Country'];
        d['Emotion  '] = d['Emotion'];
        return d;
    }, cardNewsUrl);

</script>
</body>
</html>